# 브라우저 저장소 (Theory of Browser Storage) : 웹 스토리지, 쿠키 등

---

#### 웹 스토리지(Web Storage)

``` 
해당 도메인과 관련된 특정 웹 데이터를 클라이언트에 저장하기 위해 만들어진 키-밸류 형식의 저장소
```

**장점**

- 서버에 불필요하게 데이터 저장 X
- 넉넉한 데이터 저장 용량 (모바일 : 2.5MB, 데스크탑 : 5~10MB)
- 문자열 외에도 JS의 모든 원시형 데이터와 객체 저장 가능
- 도메인 단위로 접근이 제한되는 CORS 특성 덕분에 CSRF로부터 안전

**단점**

- HTML5를 지원하는 브라우저만 사용 가능
- XSS로부터 위험 
  - -local storage에 접근하는 JS 코드로 쉽게 접근 가능

**종류**

- **로컬 스토리지(Local Storage)** - 영구 저장소
  - 영구성 : 브라우저를 종료해도 데이터를 보관
  - 범위 : 도메인만 같으면 전역적으로 데이터가 공유됨
  - 사용처 : 자동 로그인
- **세션 스토리지(Session Storage)** - 임시 저장소
  - 비영구성 : 브라우저가 종료되면 데이터가 삭제됨
  - 범위 : 도메인이 같더라도 브라우저가 다르면 (탭 브라우저, 다른 브라우저) 브라우저 컨텍스트가 다르기 때문에 데이터가 공유되지 않음
  - 사용처 : 일회성 로그인, 입력 폼 저장, 비로그인 장바구니 등

---

#### 쿠키(Cookie)

```
서버와 클라이언트 간의 지속적인 데이터 교환을 위해 만들어진 키-밸류 형식의 저장소
```

**쿠키의 목적**

- 세션 관리 : 서버가 알아야 될 정보 (로그인 및 사용자 정보, 접속시간 등)
- 개인화 : 사용자에 맞는 페이지 제공
- 트래킹 : 사용자 행동 및 패턴 분석

**장점**

- 데이터 유효기간 지정 가능
- XSS(사이트 간 악성 JS 코드를 심는 행위)로부터 안전
  - 서버에서 쿠키의 httpOnly 옵션을 설정하면, JS에서 쿠키에 접근 자체가 불가능

**단점**

- 매우 작은 데이터 저장 용량 (4KB)
- 매번 서버에 HTTP 요청시 같이 전달되어 서버에 부담
- 암호화가 안되어 있어 유저 정보 도난 위험
- CSRF(사이트 간 요청 위조) 위협
  - 공격자가 사용자의 요청을 가로챈 뒤 사용자의 의지와 상관없이 보안적으로 위험한 행동을 하게끔 변조하여 부당 이익을 취하는 행위
- 문자열만 저장 가능

**사용처**

- 다시 보지 않음 쿠키 팝업창, 로그인 자동 완성 등

---

#### Cookie vs Web Storage

- **쿠키는 매번 서버로 전송된다.**

  ```
  웹 사이트에서 쿠키를 설정하면 이후 모든 웹 요청은 쿠키정보를 포함해 서버로 전송됨.
  
  Web Storage는 저장된 데이터가 클라이언트에 존재할 뿐 서버로 전송되지는 않음
  -> 네트워크 트래픽 비용 감소
  ```

- **Web Storage는 단순 문자열을 넘어(스크립트) 객체 정보를 저장할 수 있다.**

  ```
  Web Storage는 문자열 기반 데이터 외에 체계적으로 구조화된 객체를 저장할 수 있다.
  -> 개발 편의성 제공
  ```

- **Web Storage는 용량의 제한이 없다.**

  ```
  쿠키는 개수와 용량에 제한이 있다. 클라이언트에 최대 300개의 쿠키 저장 가능 및 하나의 사이트(도메인)에서는 최대 20개 저장 가능, 쿠키 당 최대 4KB 용량 제한
  
  Web Storage는 개수 제한이 없다. 용량도 모바일 : 2.5MB, 데스크탑 : 5~10MB로 넉넉함
  ```

- **Web Storage는 영구 데이터 저장이 가능하다.**

  ```
  쿠키는 만료일자를 지정해야 하기 때문에 언젠가 제거됨. 만약 만료일자를 지정하지 않으면 세션 쿠키가 됨. 물론 만료일자를 멀게 하여 영구 쿠키로 만들 수 있음.
  
  Web Storage는 만료기간의 설정이 없다. 즉, 한 번 저장한 데이터는 영구적으로 존재가능함.
  ```

  - 세션 쿠키(Session Cookie) : 활성 웹 브라우저 세션이 있는 기간동안 저장됨. 세션 쿠키는 일반적으로 웹 브라우저를 닫을 때 삭제됨
  - 영구 쿠키(Persistent Cookie) : 각 쿠키에 지정된 기간동안 또는 장치에서 쿠키를 수동으로 삭제할 때까지 장치에 남아있음

---

#### 세션(Session)

- 쿠키는 방문자의 정보를 방문자의 컴퓨터 메모리에 저장
- 세션은 방문자의 요청에 따른 정보를 방문자 메모리가 아니라, 웹 서버가 **세션 아이디** 파일을 만들어 서비스가 돌아가고 있는 **서버에 저장**
  - 사용자의 로그인 정보에 대한 **보안**을 한층 업그레이드 가능
  - 웹사이트에 방문하여 계속 접속을 유지할 때 이전의 접속 정보를 이용할 수 있는 방법으로 많이 사용함
  - 사용자가 많아질수록 서버 메모리를 많이 차지하게 되어 성능 저하의 주요 원인이 됨
- 쿠키처럼 만료일 설정이 가능하지만, 브라우저가 종료되면 만료시간에 상관 없이 삭제됨



#### 쿠키 vs 세션

- **쿠키는 서버에 요청시 세션보다 속도가 빠르다.**

  ``` 
  세션은 정보가 서버에 있기 때문에 처리가 요구되어서 비교적 속도가 느린 편이다.
  ```

- **쿠키는 클라이언트 쪽에 정보를 저장하지만 세션은 서버 쪽에 정보를 저장한다.(저장위치 차이)**

  ```
  세션의 보안이 더 좋지만 사용자가 많아질수록 서버 메모리를 차지하게 되어 성능이 저하된다는 단점이 있다.
  ```

- **쿠키는 데이터 영구 보존이 가능하지만 세션은 브라우저 종료시 자동으로 사라진다. (라이프사이클 차이)**

  ```
  쿠키와 세션 모두 만료시간을 설정할 수 있지만 쿠키는 영구적으로 데이터 보존이 가능한 반면 세션은 브라우저 종료시 자동으로 사라진다.
  ```



#### 쿠키/세션 vs 캐시

```
캐시는 이미지나 css, js파일 등을 브라우저나 서버 앞단에 저장해놓고 사용하는 것.
한 번 캐시에 저장되면 브라우저를 참고하기 때문에 서버에서 변경이 되어도 사용자는 변경되지 않게 보일 수 있는데, 이런 부분은 캐시를 지워주거나 서버에서 클라이언트로 응답을 보낼 때 header에 캐시 만료시간을 명시함으로써 해결 가능
```



#### 세션 ID

```
클라이언트가 Request를 보내면, 해당 서버의 엔진이 클라이언트에게 유일한 ID를 부여하는데, 이것이 세션 ID이다.
```

